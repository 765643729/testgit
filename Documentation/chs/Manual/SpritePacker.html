<!DOCTYPE html><html lang="en" class="no-js">
<head>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Unity - Manual: Sprite Packer</title>
<meta name="description" content="The Unity Manual helps you learn and use the Unity engine. With the Unity engine you can create 2D and 3D games, apps and experiences.">
<meta name="author" content="Unity Technologies">
<link rel="shortcut icon" href="../StaticFilesManual/images/favicons/favicon.ico">
<link rel="icon" type="image/png" href="../StaticFilesManual/images/favicons/favicon.png">
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="../StaticFilesManual/images/favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../StaticFilesManual/images/favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="../StaticFilesManual/images/favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="../StaticFilesManual/images/favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="../StaticFilesManual/images/favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon-precomposed" href="../StaticFilesManual/images/favicons/apple-touch-icon.png">
<meta name="msapplication-TileColor" content="#222c37">
<meta name="msapplication-TileImage" content="../StaticFilesManual/images/favicons/tileicon-144x144.png">
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-2854981-1']);
  _gaq.push(['_setDomainName', 'unity3d.com']);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
  </script><script type="text/javascript" src="../StaticFilesManual/js/jquery.js?ts=1480000337"></script><script type="text/javascript" src="../StaticFilesManual/js/core.js?ts=1480000337"></script><script type="text/javascript" src="docdata/toc.js?ts=1480000337"></script><script type="text/javascript" src="docdata/global_toc.js?ts=1480000337"></script><link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700,400italic" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="../StaticFilesManual/css/core.css?ts=1480000337">
</head>
<body>
<div class="header-wrapper">
<div id="header" class="header"><div class="content">
<div class="spacer"><div class="menu">
<div class="logo"><a href="http://docs.unity3d.com"></a></div>
<div class="search-form"><form action="30_search.html" method="get" class="apisearch">
<input type="text" name="q" placeholder="Search manual..." autosave="Unity Reference" results="5" class="sbox field" id="q"><input type="submit" class="submit">
</form></div>
<ul>
<li><a href="../Manual/index.html" class="selected">Manual</a></li>
<li><a href="../ScriptReference/index.html">Scripting API</a></li>
</ul>
</div></div>
<div class="more">
<div class="filler"></div>
<ul><li><a href="http://unity3d.com/">unity3d.com</a></li></ul>
</div>
</div></div>
<div class="toolbar"><div class="content">
<div class="version-number">Version: <b>5.5</b> (<a href="http://docs.unity3d.com/540/Documentation/Manual">switch to 5.4</a>)</div>
<div class="lang-switcher">
<div class="current toggle" data-target=".lang-list">
<div class="lbl">Language: <span class="b">English</span>
</div>
<div class="arrow"></div>
</div>
<div class="lang-list" style="display:none;"><ul>
<li><a href="/Manual/SpritePacker.html">English</a></li>
<li><a href="/ja/current/Manual/SpritePacker.html">日本語</a></li>
<li><a href="/es/current/Manual/SpritePacker.html">Español</a></li>
<li><a href="/kr/current/Manual/SpritePacker.html">한국어</a></li>
<li><a href="/ru/current/Manual/SpritePacker.html">Русский</a></li>
</ul></div>
</div>
</div></div>
</div>
<div id="master-wrapper" class="master-wrapper clear">
<div id="sidebar" class="sidebar"><div class="sidebar-wrap"><div class="content"><div class="sidebar-menu"><div class="toc"><h2>Unity Manual</h2></div></div></div></div></div>
<div id="content-wrap" class="content-wrap"><div class="content-block"><div class="content">
<div class="section">
<div class="breadcrumbs clear"><ul>
<li><a href="UnityManual.html">Unity Manual</a></li>
<li><a href="Unity2D.html">Unity 2D</a></li>
<li><a href="Sprites.html">Sprites</a></li>
<li>Sprite Packer</li>
</ul></div>
<div class="mb20"><div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="SpriteEditor.html"></a></span><div class="tip">Sprite Editor</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="Physics2DReference.html"></a></span><div class="tip">2D Physics Reference</div>
</div>
</div></div>
<h1>精灵打包器（Sprite Packer）</h1>
<!--BeginSwitchLink--><!--EndSwitchLink-->
<div class="clear"></div>

<p>在设计精灵图形时，为每个角色使用单独的纹理文件很方便。然而，精灵纹理的很大一部分被图形之间的空白所占据，并且会在运行时浪费内存。为了最佳的性能，最好把几个单独的精灵纹理打包到一个称为图集（atlas）的单一纹理中。Unity提供<strong>Sprite Packer</strong>功能来自动处理从个人的精灵纹理中生成图集。</p>

<p>Unity处理后台的的精灵纹理图集的生成和使用，使用户无需手动分配。可以选择在进入Play模式时或者在构建时打包图集，并且精灵对象的图形一旦生成了就可以获取到。</p>

<p>用户必须在Texture Importer里指定Packing Tag来对那个纹理的精灵你进行打包。</p>

<h2>使用精灵打包器（Using the Sprite Packer）</h2>

<p>Sprite Packer默认是禁用的，你可以在Editor设置中配置它。（菜单：<strong>Edit -&gt; Project Settings -&gt; Editor</strong>）。精灵打包模式可以从<strong>Disabled</strong>修改为<strong>Enabled for Builds</strong>。（即打包是用于构建而非Play模式）或者<strong>Always Enabled</strong>（即打包可以同时用于Play模式和构建）。</p>

<p>打开Sprite Packer窗口（菜单：<strong>Window -&gt; Sprite Packer</strong>），然后点击左上角的<strong>Pack</strong>按钮，你会看到图集中打包的纹理的排列。</p>

<figure>
<img src="../uploads/Main/SpritePackerMain.png" alt="">
</figure>

<p>在Project面板中选择一个精灵，也会高亮显示它在图集中的位置。这个轮廓实际上是渲染网格的轮廓，并且还定义了打包的区域。</p>

<p>Sprite Packer窗口顶部的工具栏中有一些影响打包和查看的控件。<strong>Pack</strong>按钮开始打包操作，但是如果图集没有改变的话不会强制执行任何更新。（当你如下方<strong>Customizing the Sprite Packer</strong>所述执行自定义打包时，会显示相关的<strong>Repack</strong>按钮）。<strong>View Atlas</strong>和<strong>Page #</strong>菜单可以选择在窗口中展示哪些图集的哪些页面（如果所有精灵的最大纹理大小没有足够的空间，一个图集可能会被分割成多个“page”）。页码旁边的菜单可以选择图集使用哪种“packing policy”（见下文）。工具栏的右侧有两个控制视图大小的控制器，并且可以选择图集的颜色和alpha展示。</p>

<h2>包装策略（Packing Policy）</h2>

<p>精灵打包器使用<strong>packing policy</strong>来决定怎样把精灵分配到图集中。你可以创建自己的打包策略（见下文），也可以使用<strong>Default Packer Policy</strong>，<strong>Tight Packer Policy</strong>以及<strong>Tight Rotate Enabled Sprite Packer Policy</strong>选项。<a href="class-TextureImporter.html">Texture Importer</a>的<strong>Packing Tag</strong>属性可直接选择要打包的精灵的图集的名称，所有有相同打包标签的精灵会被打包到同一个图集。然后这些图集可以通过纹理导入设置进一步排序，使他们能匹配用户对资源纹理的所有设置。相同纹理的精灵会尽可能的分配到相同图集中。</p>

<ul>
<li>DefaultPackerPolicy默认使用矩形打包，或者通过<strong>Packing Tag</strong>中的“[TIGHT]”指定（即：设置打包标签为“[TIGHT]Character”可紧密打包）。</li>
<li>TightPackerPolicy在精灵有紧密网格的情况下默认使用紧密打包。如果在<strong>Packing Tag</strong>指定了“[RECT]”，会使用矩形打包。（即：设置打包标签为“[RECT]UI_Elements”会强制使用矩形打包）。</li>
<li>TightRotateEnabledSpritePackerPolicy在精灵有紧密网格的情况下默认使用紧密打包，并将启用精灵旋转。如果在<strong>Packing Tag</strong>中指定了“[RECT]”，会使用矩形打包（即：设置打包标签为“[RECT]UI_Elements”会强制使用矩形打包）。</li>
</ul>

<h2>自定义精灵打包（Customizing the Sprite Packer）</h2>

<p><strong>DefaultPackerPolicy</strong>选项对于大部分情况下已经足够了，但是你也可以实现自定义打包策略。为此，你需要在编辑脚本中为类实现UnityEditor.Sprites.IPackerPolicy接口。这个接口需要以下方法：</p>

<ul>
<li>GetVersion - 返回打包策略的版本值。如果策略脚本有修改，需要更新版本并保存到版本控制器。</li>
<li>OnGroupAtlases - 在这里实现你的打包逻辑。在PackerJob定义图集，并且从给定的TextureImporters分配精灵。</li>
</ul>

<p>DefaultPackerPolicy默认使用矩形打包（参见SpritePackingMode）。这对纹理空间（texture-space）效果和使用不同的网格渲染精灵非常有用。自定义策略可以覆盖它并使用紧密包装。</p>

<ul>
<li>Repack按钮只有在选择自定义策略时生效。

<ul>
<li>除非使用TextureImporter元数据或者选择的PackerPolicy版本值有更改，否则OnGroupAtlases不会被调用。</li>
<li>当你使用自定义策略时使用Repack按钮。</li>
</ul>
</li>
<li>精灵可以使用TightRotateEnabledSpritePackerPolicy自动旋转。

<ul>
<li>SpritePackingRotation是未来的Unity版本的保留类型。</li>
</ul>
</li>
</ul>

<h2>其他</h2>

<ul>
<li>图集缓存在Project\Library\AtlasCache中。

<ul>
<li>删除文件夹然后启动Unity将强制重新打包图集。Unity必须必须在此期间处于关闭状态。</li>
</ul>
</li>
<li>图集的缓存不会在启动时加载。

<ul>
<li>所有的纹理在Unity重启后第一次打包时都需要检测一遍。这个操作会根据工程中纹理的总数花费一些时间。</li>
<li>只会加载需要的图集。</li>
</ul>
</li>
<li>图集默认的最大大小为2048x2048。</li>
<li>设置了PackingTag时，纹理不会被压缩，以便SpritePacker获取原始的像素值然后压缩图集。</li>
</ul>

<h2>DefaultPackerPolicy</h2>

<pre><code>using System;
using System.Linq;
using UnityEngine;
using UnityEditor;
using System.Collections.Generic;


public class DefaultPackerPolicySample : UnityEditor.Sprites.IPackerPolicy
{
        protected class Entry
        {
            public Sprite            sprite;
        public UnityEditor.Sprites.AtlasSettings settings;
            public string            atlasName;
            public SpritePackingMode packingMode;
            public int               anisoLevel;
        }

        private const uint kDefaultPaddingPower = 3; // Good for base and two mip levels.

        public virtual int GetVersion() { return 1; }
        protected virtual string TagPrefix { get { return &quot;[TIGHT]&quot;; } }
        protected virtual bool AllowTightWhenTagged { get { return true; } }
        protected virtual bool AllowRotationFlipping { get { return false; } }

    public static bool IsCompressedFormat(TextureFormat fmt)
    {
        if (fmt &gt;= TextureFormat.DXT1 &amp;&amp; fmt &lt;= TextureFormat.DXT5)
            return true;
        if (fmt &gt;= TextureFormat.DXT1Crunched &amp;&amp; fmt &lt;= TextureFormat.DXT5Crunched)
            return true;
        if (fmt &gt;= TextureFormat.PVRTC_RGB2 &amp;&amp; fmt &lt;= TextureFormat.PVRTC_RGBA4)
            return true;
        if (fmt == TextureFormat.ETC_RGB4)
            return true;
        if (fmt &gt;= TextureFormat.ATC_RGB4 &amp;&amp; fmt &lt;= TextureFormat.ATC_RGBA8)
            return true;
        if (fmt &gt;= TextureFormat.EAC_R &amp;&amp; fmt &lt;= TextureFormat.EAC_RG_SIGNED)
            return true;
        if (fmt &gt;= TextureFormat.ETC2_RGB &amp;&amp; fmt &lt;= TextureFormat.ETC2_RGBA8)
            return true;
        if (fmt &gt;= TextureFormat.ASTC_RGB_4x4 &amp;&amp; fmt &lt;= TextureFormat.ASTC_RGBA_12x12)
            return true;
        if (fmt &gt;= TextureFormat.DXT1Crunched &amp;&amp; fmt &lt;= TextureFormat.DXT5Crunched)
            return true;
        return false;
    }

    public void OnGroupAtlases(BuildTarget target, UnityEditor.Sprites.PackerJob job, int[] textureImporterInstanceIDs)
        {
            List&lt;Entry&gt; entries = new List&lt;Entry&gt;();

            foreach (int instanceID in textureImporterInstanceIDs)
            {
                TextureImporter ti = EditorUtility.InstanceIDToObject(instanceID) as TextureImporter;

                TextureFormat desiredFormat;
                ColorSpace colorSpace;
                int compressionQuality;
                ti.ReadTextureImportInstructions(target, out desiredFormat, out colorSpace, out compressionQuality);

                TextureImporterSettings tis = new TextureImporterSettings();
                ti.ReadTextureSettings(tis);

            Sprite[] sprites =
                AssetDatabase.LoadAllAssetRepresentationsAtPath(ti.assetPath)
                    .Select(x =&gt; x as Sprite)
                    .Where(x =&gt; x != null)
                    .ToArray();
                foreach (Sprite sprite in sprites)
                {
                    Entry entry = new Entry();
                    entry.sprite = sprite;
                    entry.settings.format = desiredFormat;
                    entry.settings.colorSpace = colorSpace;
                    // Use Compression Quality for Grouping later only for Compressed Formats. Otherwise leave it Empty.
                entry.settings.compressionQuality = IsCompressedFormat(desiredFormat) ? compressionQuality : 0;
                entry.settings.filterMode = Enum.IsDefined(typeof(FilterMode), ti.filterMode)
                    ? ti.filterMode
                    : FilterMode.Bilinear;
                    entry.settings.maxWidth = 2048;
                    entry.settings.maxHeight = 2048;
                    entry.settings.generateMipMaps = ti.mipmapEnabled;
                    entry.settings.enableRotation = AllowRotationFlipping;
                    if (ti.mipmapEnabled)
                        entry.settings.paddingPower = kDefaultPaddingPower;
                    else
                        entry.settings.paddingPower = (uint)EditorSettings.spritePackerPaddingPower;
                    #if ENABLE_ANDROID_ATLAS_ETC1_COMPRESSION
                        entry.settings.allowsAlphaSplitting = ti.GetAllowsAlphaSplitting ();
                    #endif //ENABLE_ANDROID_ATLAS_ETC1_COMPRESSION

                    entry.atlasName = ParseAtlasName(ti.spritePackingTag);
                    entry.packingMode = GetPackingMode(ti.spritePackingTag, tis.spriteMeshType);
                    entry.anisoLevel = ti.anisoLevel;

                    entries.Add(entry);
                }

                Resources.UnloadAsset(ti);
            }

            // First split sprites into groups based on atlas name
            var atlasGroups =
                from e in entries
                group e by e.atlasName;
            foreach (var atlasGroup in atlasGroups)
            {
                int page = 0;
                // Then split those groups into smaller groups based on texture settings
                var settingsGroups =
                    from t in atlasGroup
                    group t by t.settings;
                foreach (var settingsGroup in settingsGroups)
                {
                    string atlasName = atlasGroup.Key;
                    if (settingsGroups.Count() &gt; 1)
                        atlasName += string.Format(&quot; (Group {0})&quot;, page);

                UnityEditor.Sprites.AtlasSettings settings = settingsGroup.Key;
                    settings.anisoLevel = 1;
                    // Use the highest aniso level from all entries in this atlas
                    if (settings.generateMipMaps)
                        foreach (Entry entry in settingsGroup)
                            if (entry.anisoLevel &gt; settings.anisoLevel)
                                settings.anisoLevel = entry.anisoLevel;

                    job.AddAtlas(atlasName, settings);
                    foreach (Entry entry in settingsGroup)
                    {
                        job.AssignToAtlas(atlasName, entry.sprite, entry.packingMode, SpritePackingRotation.None);
                    }

                    ++page;
                }
            }
        }

        protected bool IsTagPrefixed(string packingTag)
        {
            packingTag = packingTag.Trim();
            if (packingTag.Length &lt; TagPrefix.Length)
                return false;
            return (packingTag.Substring(0, TagPrefix.Length) == TagPrefix);
        }

        private string ParseAtlasName(string packingTag)
        {
            string name = packingTag.Trim();
            if (IsTagPrefixed(name))
                name = name.Substring(TagPrefix.Length).Trim();
            return (name.Length == 0) ? &quot;(unnamed)&quot; : name;
        }

        private SpritePackingMode GetPackingMode(string packingTag, SpriteMeshType meshType)
        {
            if (meshType == SpriteMeshType.Tight)
                if (IsTagPrefixed(packingTag) == AllowTightWhenTagged)
                    return SpritePackingMode.Tight;
            return SpritePackingMode.Rectangle;
        }
}
</code></pre>

<h2>TightPackerPolicy</h2>

<pre><code>using System;
using System.Linq;
using UnityEngine;
using UnityEditor;
using UnityEditor.Sprites;
using System.Collections.Generic;

// TightPackerPolicy will tightly pack non-rectangle Sprites unless their packing tag contains &quot;[RECT]&quot;.
class TightPackerPolicySample : DefaultPackerPolicySample
{
        protected override string TagPrefix { get { return &quot;[RECT]&quot;; } }
        protected override bool AllowTightWhenTagged { get { return false; } }
        protected override bool AllowRotationFlipping { get { return false; } }
}
</code></pre>

<h2>TightRotateEnabledSpritePackerPolicy</h2>

<pre><code>using System;
using System.Linq;
using UnityEngine;
using UnityEditor;
using UnityEditor.Sprites;
using System.Collections.Generic;

// TightPackerPolicy will tightly pack non-rectangle Sprites unless their packing tag contains &quot;[RECT]&quot;.
class TightRotateEnabledSpritePackerPolicySample : DefaultPackerPolicySample
{
        protected override string TagPrefix { get { return &quot;[RECT]&quot;; } }
        protected override bool AllowTightWhenTagged { get { return false; } }
        protected override bool AllowRotationFlipping { get { return true; } }
}

</code></pre>
<div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="SpriteEditor.html"></a></span><div class="tip">Sprite Editor</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="Physics2DReference.html"></a></span><div class="tip">2D Physics Reference</div>
</div>
</div>
</div>
<div class="footer-wrapper"><div class="footer clear">
<div class="copy">
<known_issues><p>Is something described here not working as you expect it to? It might be a <b>Known Issue</b>. Please check with the Issue Tracker at <a href="http://issuetracker.unity3d.com">issuetracker.unity3d.com</a>.</p></known_issues>Copyright © 2016 Unity Technologies. Publication 5.5-Z</div>
<div class="menu">
<a href="http://unity3d.com/learn">Tutorials</a><a href="http://answers.unity3d.com">Community Answers</a><a href="https://support.unity3d.com/hc/en-us">Knowledge Base</a><a href="http://forum.unity3d.com">Forums</a><a href="http://unity3d.com/asset-store">Asset Store</a>
</div>
</div></div>
</div></div></div>
</div>
<!--<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MC35ML" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-MC35ML');</script>-->
</body>
</html>
