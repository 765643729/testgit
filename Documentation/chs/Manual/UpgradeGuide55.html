<!DOCTYPE html><html lang="en" class="no-js">
<head>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Unity - Manual: Upgrading to Unity 5.5 beta</title>
<meta name="description" content="The Unity Manual helps you learn and use the Unity engine. With the Unity engine you can create 2D and 3D games, apps and experiences.">
<meta name="author" content="Unity Technologies">
<link rel="shortcut icon" href="../StaticFilesManual/images/favicons/favicon.ico">
<link rel="icon" type="image/png" href="../StaticFilesManual/images/favicons/favicon.png">
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="../StaticFilesManual/images/favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../StaticFilesManual/images/favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="../StaticFilesManual/images/favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="../StaticFilesManual/images/favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="../StaticFilesManual/images/favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon-precomposed" href="../StaticFilesManual/images/favicons/apple-touch-icon.png">
<meta name="msapplication-TileColor" content="#222c37">
<meta name="msapplication-TileImage" content="../StaticFilesManual/images/favicons/tileicon-144x144.png">
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-2854981-1']);
  _gaq.push(['_setDomainName', 'unity3d.com']);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
  </script><script type="text/javascript" src="../StaticFilesManual/js/jquery.js?ts=1480000337"></script><script type="text/javascript" src="../StaticFilesManual/js/core.js?ts=1480000337"></script><script type="text/javascript" src="docdata/toc.js?ts=1480000337"></script><script type="text/javascript" src="docdata/global_toc.js?ts=1480000337"></script><link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700,400italic" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="../StaticFilesManual/css/core.css?ts=1480000337">
</head>
<body>
<div class="header-wrapper">
<div id="header" class="header"><div class="content">
<div class="spacer"><div class="menu">
<div class="logo"><a href="http://docs.unity3d.com"></a></div>
<div class="search-form"><form action="30_search.html" method="get" class="apisearch">
<input type="text" name="q" placeholder="Search manual..." autosave="Unity Reference" results="5" class="sbox field" id="q"><input type="submit" class="submit">
</form></div>
<ul>
<li><a href="../Manual/index.html" class="selected">Manual</a></li>
<li><a href="../ScriptReference/index.html">Scripting API</a></li>
</ul>
</div></div>
<div class="more">
<div class="filler"></div>
<ul><li><a href="http://unity3d.com/">unity3d.com</a></li></ul>
</div>
</div></div>
<div class="toolbar"><div class="content">
<div class="version-number">Version: <b>5.5</b> (<a href="http://docs.unity3d.com/540/Documentation/Manual">switch to 5.4</a>)</div>
<div class="lang-switcher">
<div class="current toggle" data-target=".lang-list">
<div class="lbl">Language: <span class="b">English</span>
</div>
<div class="arrow"></div>
</div>
<div class="lang-list" style="display:none;"><ul>
<li><a href="/Manual/UpgradeGuide55.html">English</a></li>
<li><a href="/ja/current/Manual/UpgradeGuide55.html">日本語</a></li>
<li><a href="/es/current/Manual/UpgradeGuide55.html">Español</a></li>
<li><a href="/kr/current/Manual/UpgradeGuide55.html">한국어</a></li>
<li><a href="/ru/current/Manual/UpgradeGuide55.html">Русский</a></li>
</ul></div>
</div>
</div></div>
</div>
<div id="master-wrapper" class="master-wrapper clear">
<div id="sidebar" class="sidebar"><div class="sidebar-wrap"><div class="content"><div class="sidebar-menu"><div class="toc"><h2>Unity Manual</h2></div></div></div></div></div>
<div id="content-wrap" class="content-wrap"><div class="content-block"><div class="content">
<div class="section">
<div class="breadcrumbs clear"><ul>
<li><a href="UnityManual.html">Unity Manual</a></li>
<li><a href="UnityOverview.html">Working In Unity</a></li>
<li><a href="UpgradeGuides.html">Upgrade Guides</a></li>
<li>Upgrading to Unity 5.5 beta</li>
</ul></div>
<div class="mb20"><div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="APIUpdater.html"></a></span><div class="tip"> Using the Automatic API Updater</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="UpgradeGuide54.html"></a></span><div class="tip">Upgrading to Unity 5.4</div>
</div>
</div></div>
<h1>Upgrading to Unity 5.5 beta</h1>
<!--BeginSwitchLink--><!--EndSwitchLink-->
<div class="clear"></div>

<p>
<strong>Note:</strong> <em>This guide is for a beta release and may not list all known upgrade issues.</em> <em>For more information about what’s new in 5.5b and for more detailed upgrade notes, please see the <a href="https://unity3d.com/unity/beta#notes">5.5 Beta Release Notes</a></em>
</p>

<h2>Upgrading Shader Code to 5.5</h2>

<h3>Shaders: Renamed variables, functions</h3>

<ul>
<li>
<code>roughness</code> is now <code>perceptualRoughness</code>
</li>
<li>
<code>OneMinusRoughness</code> is now <code>Smoothness</code>
</li>
<li>
<code>RoughnessToSpecPower</code> is now <code>PerceptualRoughnessToSpecPower</code>
</li>
</ul>

<h3>Shaders: New Conversion functions</h3>

<p>There are now functions to convert between smoothness, roughness and perceptual roughness:</p>

<ul>
<li><code>PerceptualRoughnessToRoughness</code></li>
<li><code>RoughnessToPerceptualRoughness</code></li>
<li><code>SmoothnessToRoughness</code></li>
<li><code>RoughnessToSmoothness</code></li>
</ul>

<h3>Shaders: Other changes</h3>

<ul>
<li><p>The visibility term in <code>UnityStandardBRDF.cginc</code> takes <code>roughness</code> and not <code>perceptualRoughness</code>.</p></li>
<li><p>In older versions of Unity, there it was possible to do a remapping with Marmoset roughness. With the move to GGX it no longer matches. If a match is needed, the Marmoset developer should provide one, or the Marmoset shader should be modified instead.</p></li>
<li><p>
<code>UNITY_GLOSS_MATCHES_MARMOSET_TOOLBAG2</code> definition and associated code is no longer supported and has been removed.</p></li>
<li><p>All read or write into the Gbuffer must go through new abstraction functions <code>UnityStandardDataToGbuffer</code> / <code>UnityStandardDataFromGbuffer</code>
</p></li>
<li><p>Your shader code should call <code>UnityGlossyEnvironmentSetup()</code> to initialize a <code>Unity_GlossyEnvironmentData</code> struct instead of doing it manually. </p></li>
<li><p>The <code>roughness</code> variable of <code>Unity_GlossyEnvironmentData</code> is actually <code>perceptualRoughness</code> but it hasn’t been renamed to avoid errors with existing shader code. Note: <code>UnityGlossyEnvironmentSetup</code> takes <code>smoothness</code> as a parameter and calculates <code>perceptualRoughness</code>.</p></li>
<li><p>The <code>ndotl</code> variable value in <code>UnityLight</code> is now calculated on the fly and thus should not be used anymore. It has not been removed to avoid errors with existing shader code.</p></li>
<li><p>The <code>UNITY_GI</code> macro should not be used anymore. It has not been removed to avoid errors with existing shader code.</p></li>
<li><p>A new file <code>UnityDeprecated.cginc</code> has been created to store deprecated functions. These functions will be deleted in a later version of Unity, so please upgrade your shader code if you rely on them.</p></li>
<li>Deprecated code which has been moved to <code>UnityDeprecated.cginc</code>:

<ul>
<li><code>LazarovFresnelTerm</code></li>
<li><code>SebLagardeFresnelTerm</code></li>
<li><code>CookTorranceVisibilityTerm</code></li>
<li><code>KelemenVisibilityTerm</code></li>
<li><code>ModifiedKelemenVisibilityTerm</code></li>
<li><code>RDFBlinnPhongNormalizedTerm</code></li>
<li><code>BlinnTerm</code></li>
<li><code>LambertTerm</code></li>
<li><code>DotClamped</code></li>
<li>
<code>DecodeHDR_NoLinearSupportInSM2</code> (renamed it to DecodeHDR due to sm 2 support removal)</li>
<li>
<code>Unity_GlossyEnvironment</code> (previous declaration deprecated)</li>
</ul>
</li>
</ul>

<h3>Shaders: DirectX 9 half-pixel offset issue</h3>

<p>Unity 5.5 now handles DX9 half-pixel offset rasterization in the background, which means you no longer need to fix DX9 half-pixel issues either in shaders or in code. See more details in <a href="http://aras-p.info/blog/2016/04/08/solving-dx9-half-pixel-offset/">this blog post</a>. If you use any of these checks in your code, they can now be removed:</p>

<ul>
<li>Checks in shaders for UNITY_HALF_TEXEL_OFFSET and shifting vertices/UVs based on that.</li>
<li>Checks for D3D9 via SystemInfo.graphicsDeviceType or SystemInfo.graphicsDeviceVersion, and shifting vertices/UVs based on that.</li>
</ul>

<p>The way Unity solves this now is by inserting half-pixel adjustment code into all vertex shaders that are being compiled. As a result, vertex shader constant register c255 becomes reserved by Unity, as well as two instructions being added to all shaders, and one more temporary register is used. This should not create problems, unless your vertex shaders use up all the available resources (constant/temporary registers and instruction slots) to the absolute maximum.</p>

<h3>Shaders: Z-buffer float inverted</h3>

<p>The Z-buffer (depth buffer) direction has been inverted and this means the Z-buffer will now contain 1.0 at the near plane, 0.0 at the far plane. This, combined with the floating point depth buffer significantly increases the depth buffer precision resulting in less Z-fighting and better shadows, especially when using small near planes and large far planes.</p>

<p>Graphics API changes: </p>

<ul>
<li>Clip space range is [near, 0] instead of [0, far]</li>
<li>_CameraDepthTexture texture range is [1,0] instead of [0,1]</li>
<li>Z-bias is negated before being applied</li>
<li>24 bit depth buffers are switched to 32 bit float format</li>
</ul>

<p>The following macros/functions will handle reversed Z situations without any other steps. If your shader was already using them, then no changes needed from your side:</p>

<ul>
<li>Linear01Depth(float z)</li>
<li>LinearEyeDepth(float z)</li>
<li>UNITY_CALC_FOG_FACTOR(coord)</li>
</ul>

<p>However if you are fetching the Z buffer value manually you will need to do write code similar to:</p>

<pre><code>float z = tex2D(_CameraDepthTexture, uv);
#if defined(UNITY_REVERSED_Z)
    z = 1.0f - z;
#endif
</code></pre>

<p>For clip space depth you can use the following macro. Please <strong>note</strong> that this macro will not alter clip space on OpenGL/ES plaforms but will remain <code>[-near, far]</code>:</p>

<pre><code>float clipSpaceRange01 = UNITY_Z_0_FAR_FROM_CLIPSPACE(rawClipSpace);
</code></pre>

<p>Z-bias is handled automatically by Unity but if you are using a native code rendering plugin you will need to negate it in your C/C++ code on matching platforms.</p>

<h2>Special Folder: Unity Editor subfolder named “Resources”</h2>

<p>All subfolders of the folder named <strong>“Editor”</strong> will be excluded from the build and will not load in Play mode in the Unity Editor. Previously a subfolder named <strong>“Resources”</strong> would have its assets included in the build. These assets are still loadable by calling Resources.Load() in your Editor scripts. </p>

<p>For example, these files are excluded from the build and will <strong>not</strong> load when in Play mode in the Editor, but <strong>will</strong> load if called from scripts:</p>

<ul>
<li>Editor/Foo/Resources/Bar.png <em>(this loads from Editor code as “Bar.png”)</em>
Editor/Resources/Foo.png</li>
<li>Editor/Resources/Editor/Resources/Foo.png <em>(this loads from Editor code as “Foo.png” but not as “Editor/Resources/Foo.png”)</em>
</li>
</ul>

<p>These assets will load in all situations:</p>

<ul>
<li>Resources/Editor/Foo.png</li>
<li>Resources/Foo/Editor/Bar.png <em>(this loads as “Foo/Editor/Bar.png”)</em>
</li>
<li>Resources/Editor/Resources/Foo.png <em>(this loads as “Foo.png” and not as “Editor/Resources/Foo.png”)</em>
</li>
</ul>

<h2>Backface Tolerance and Final Gather</h2>

<p>Previously the ‘Backface Tolerance’ parameter in <a href="LightmapParameters.html">Lightmap Parameters</a> was not applied when using final gather for baked GI. It is now applied correctly. The parameter now affects both the realtime GI and baked GI stages (including the final gather).</p>

<p>Affected scenes are mainly ones with single sided geometry (like billboards) where it is important to be able to adjust the ‘Backface Tolerance’ in order to avoid invalidating texels that are seeing the backface of single sided geometry. In scenes that use billboards and final gather the lightmaps can now be improved by adjusting ‘Backface Tolerance’, however other scenes might also be affected, if a non-default ‘Backface Tolerance’ is applied, since it is now correctly accounted for in the final gather stage.</p>

<h2>Standard shader BRDF2 now uses GGX approximation</h2>

<p>BRDF2, the standard shader type set on mobile platforms by default, now uses GGX approximation instead of Blinn-Phong. This makes it look closer to BRDF1 (used on desktops by default) and improves on visual quality. </p>

<p>Should you need to preserve legacy approximation you should modify the BRDF2 code in UnityStandardBRDF.cginc which has the new implementation inside the #if UNITY_BRDF_GGX statement (this is also used by BRDF1 to pick GGX). Change the definition in UnityStandardConfig.cginc or change #if UNITY_BRDF_GGX to #if 0 in the BRDF2_Unity_PBS function</p>

<h2> Gradle for Android</h2>

<p>In 5.5, you can now use <a href="android-gradle-overview.html">Gradle</a> to build for Android.</p>

<p>Gradle is not as strict about errors compared with the existing Unity Android build system, meaning that some existing projects may be hard to convert to Gradle. See documentation on <a href="android-gradle-troubleshooting.html">Gradle troubleshooting</a> to identify and solve these build failures. </p>
<div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="APIUpdater.html"></a></span><div class="tip"> Using the Automatic API Updater</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="UpgradeGuide54.html"></a></span><div class="tip">Upgrading to Unity 5.4</div>
</div>
</div>
</div>
<div class="footer-wrapper"><div class="footer clear">
<div class="copy">
<known_issues><p>Is something described here not working as you expect it to? It might be a <b>Known Issue</b>. Please check with the Issue Tracker at <a href="http://issuetracker.unity3d.com">issuetracker.unity3d.com</a>.</p></known_issues>Copyright © 2016 Unity Technologies. Publication 5.5-Z</div>
<div class="menu">
<a href="http://unity3d.com/learn">Tutorials</a><a href="http://answers.unity3d.com">Community Answers</a><a href="https://support.unity3d.com/hc/en-us">Knowledge Base</a><a href="http://forum.unity3d.com">Forums</a><a href="http://unity3d.com/asset-store">Asset Store</a>
</div>
</div></div>
</div></div></div>
</div>
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MC35ML" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-MC35ML');</script>
</body>
</html>
